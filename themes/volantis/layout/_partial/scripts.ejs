<%- js(theme.plugins.jquery) %>
<% if (theme.search && theme.search.enable) { %>
  <script>
    <% if(theme.search.service === 'baidu') { %>
      var BAIDU_API_ID = "<%- theme.search.baidu.apiId %>";
    <%} else if(theme.search.service === 'algolia') { %>
      var ALGOLIA_API_KEY = "<%- theme.search.algolia.apiKey %>";
      var ALGOLIA_APP_ID = "<%- theme.search.algolia.applicationID %>";
      var ALGOLIA_INDEX_NAME = "<%- theme.search.algolia.indexName %>";
    <%} else if(theme.search.service === 'azure') { %>
      var AZURE_QUERY_KEY = "<%- theme.search.azure.queryKey %>";
      var AZURE_INDEX_NAME = "<%- theme.search.azure.indexName %>";
      var AZURE_SERVICE_NAME = "<%- theme.search.azure.serviceName %>";
    <%} else if(theme.search.service === 'google') { %>
      var GOOGLE_CUSTOM_SEARCH_API_KEY = "<%- theme.search.google.apiKey %>";
      var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "<%- theme.search.google.engineId %>";
    <%}%>
    var SEARCH_SERVICE = "<%- theme.search.service %>" || "hexo";
    var ROOT = "<%- config.root %>" || "/";
    if (!ROOT.endsWith('/')) ROOT += '/';
  </script>
<% } %>
<% if (theme.plugins.instant_page) { %>
  <script async src="<%- theme.plugins.instant_page %>" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>
<% } %>
<% if (theme.plugins.scrollreveal && theme.plugins.scrollreveal.js) { %>
<script src="<%- theme.plugins.scrollreveal.js %>"></script>
<script type="text/javascript">
  $(function () {
    ScrollReveal().reveal('.l_main .reveal', {
      distance: '<%- theme.plugins.scrollreveal.distance %>',
      duration: '<%- theme.plugins.scrollreveal.duration %>',
      interval: '<%- theme.plugins.scrollreveal.interval %>',
      scale: '<%- theme.plugins.scrollreveal.scale %>'
    });
  });
</script>
<% } %>
<% if (theme.plugins.nodewaves && theme.plugins.nodewaves.js) { %>
  <%- js({src: theme.plugins.nodewaves.js}) %>
  <script type="text/javascript">
    $(function() {
      Waves.attach('.flat-btn', ['waves-button']);
      Waves.attach('.float-btn', ['waves-button', 'waves-float']);
      Waves.attach('.float-btn-light', ['waves-button', 'waves-float', 'waves-light']);
      Waves.attach('.flat-box', ['waves-block']);
      Waves.attach('.float-box', ['waves-block', 'waves-float']);
      Waves.attach('.waves-image');
      Waves.init();
    });
  </script>
<% } %>
<% if (theme.plugins.busuanzi) { %>
  <script async src="<%- theme.plugins.busuanzi %>"></script>
<% } %>

<% if (theme.plugins.Artitalk && theme.plugins.Artitalk.enable && page.layout == "artitalk") { %>
  <script>
    var appID ="<%=  theme.plugins.Artitalk.appID  %>";
    var appKEY ="<%=  theme.plugins.Artitalk.appKEY  %>";
    <% if(theme.plugins.Artitalk.severurl){ %>
        var severurl="<%=  theme.plugins.Artitalk.severurl  %>";
    <% } %>
    <% if(theme.plugins.Artitalk.slanguage){ %>
        var slanguage="<%=  theme.plugins.Artitalk.slanguage  %>";
    <% } %>
    <% if(theme.plugins.Artitalk.per){ %>
        var per="<%=  theme.plugins.Artitalk.per  %>";
    <% } %>
    <% if(theme.plugins.Artitalk.repo_pt_img){ %>
        var color1="<%=  theme.plugins.Artitalk.repo_pt_img  %>";
    <% } %>
    <% if(theme.plugins.Artitalk.placeholder1){ %>
        var placeholder1="<%=  theme.plugins.Artitalk.placeholder1  %>";
    <% } %>
    <% if(theme.plugins.Artitalk.placeholder2){ %>
        var placeholder2="<%=  theme.plugins.Artitalk.placeholder2  %>";
    <% } %>
    <% if(theme.plugins.Artitalk.lazy==0){ %>
        var lazy=0;
    <% }else{ %>
        var lazy=1;
    <% }  %>
    <% if(theme.plugins.Artitalk.bgimg){ %>
        var bgimg="<%=  theme.plugins.Artitalk.bgimg  %>";
    <% } %>
    <% if(theme.plugins.Artitalk.token_pt){ %>
        var token_pt="<%=  theme.plugins.Artitalk.token_pt  %>";
    <% } %>
    <% if(theme.plugins.Artitalk.color1){ %>
        var color1="<%=  theme.plugins.Artitalk.color1  %>";
    <% } %>
    <% if(theme.plugins.Artitalk.color2){ %>
        var color2="<%=  theme.plugins.Artitalk.color2  %>";
    <% } %>
    <% if(theme.plugins.Artitalk.color3){ %>
        var color3="<%=  theme.plugins.Artitalk.color3  %>";
    <% } %>
  </script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/artitalk"></script>
<% } %>
<% if (theme.plugins.backstretch && theme.plugins.backstretch.enable && (theme.plugins.backstretch.images || page.images)) { %>
  <% var imgs = theme.plugins.backstretch.images || page.images; %>
  <% var posi = null;
  if (theme.plugins.backstretch.position == 'cover') {
    posi = '.cover';
  }
   %>
  <% if (imgs != undefined && theme.plugins.backstretch.position != undefined){ %>
    <%- js(theme.plugins.backstretch.js) %>
    <script type="text/javascript">
      $(function(){
        var imgs=<%- '["' + imgs.join('", "') + '"]' %>;
        if ('<%- theme.plugins.backstretch.shuffle %>' == 'true') {
          function shuffle(arr){
            /*From countercurrent-time*/
            var n = arr.length;
            while(n--) {
              var index = Math.floor(Math.random() * n);
              var temp = arr[index];
              arr[index] = arr[n];
              arr[n] = temp;
            }
          }
          shuffle(imgs);
        }
        if ('<%- posi %>') {
          $('<%- posi %>').backstretch(
            imgs,
          {
            duration: "<%- theme.plugins.backstretch.duration %>",
            fade: "<%- theme.plugins.backstretch.fade %>"
          });
        } else {
          $.backstretch(
            imgs,
          {
            duration: "<%- theme.plugins.backstretch.duration %>",
            fade: "<%- theme.plugins.backstretch.fade %>"
          });
        }
      });
    </script>
  <% } %>
<% } %>

<% if (theme.plugins.aplayer && theme.plugins.aplayer.enable && theme.plugins.aplayer.js) { %>
  <% (theme.plugins.aplayer.js||[]).forEach(function(item){ %>
    <%- js({src:item,async:true}) %>
  <% }) %>
<% } %>

<%
  var enableDisqus = false;
  var enableLivere = false;
  var enableGitalk = false;
  var enableValine = false;
  if (theme.comments && page && page.comments == true) {
    if (theme.comments.disqus && theme.comments.disqus.shortname) {
      enableDisqus = true;
    }
    if (theme.comments.livere && theme.comments.livere.uid) {
      enableLivere = true;
    }
    if (theme.comments.gitalk && theme.comments.gitalk.clientID) {
      enableGitalk = true;
    }
    if (theme.comments.valine && theme.comments.valine.appId) {
      enableValine = true;
    }
  }
%>
<% if (enableDisqus){ %>
  <script>
    var disqus_shortname = '<%= theme.comments.disqus.shortname %>';
    <% if (page.permalink){ %>
      var disqus_url = '<%= page.permalink %>';
    <% } %>
    (function(){
      var dsq = document.createElement('script');
      dsq.type = 'text/javascript';
      dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/<% if (page.comments) { %>embed.js<% } else { %>count.js<% } %>';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
<% } %>
<% if (enableLivere){ %>
  <script type="text/javascript">
    (function(d, s) {
      var j, e = d.getElementsByTagName(s)[0];
      if (typeof LivereTower === 'function') { return; }
      j = d.createElement(s);
      j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
      j.async = true;
      e.parentNode.insertBefore(j, e);
    })(document, 'script');
  </script>
<% } %>
<% if (enableGitalk) { %>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Linhk1606/blog-cdn@0.0.3.1/css/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
  <script type="text/javascript">
    var gitalk = new Gitalk({
      clientID: "<%- theme.comments.gitalk.clientID %>",
      clientSecret: "<%- theme.comments.gitalk.clientSecret %>",
      repo: "<%- theme.comments.gitalk.repo %>",
      owner: "<%- theme.comments.gitalk.owner %>",
      admin: "<%- theme.comments.gitalk.admin %>",
      <% if(page.gitalk && page.gitalk.id) { %>
        id: decodeURI(location.pathname),
      <% } else { %>
        id: decodeURI(location.pathname),      // Ensure uniqueness and length less than 50
      <% } %>
      distractionFreeMode: false  // Facebook-like distraction free mode
    });
    gitalk.render('gitalk-container');
  </script>
<% } %>

<% if (enableValine){ %>
  <% if (theme.comments.valine.js) { %>
    <%- js(theme.comments.valine.js) %>
  <% } else { %>
    <%- js(['js/valine.js']) %>
  <% } %>
  <script>
  var GUEST_INFO = ['nick','mail','link'];
  var meta = '<%= theme.comments.valine.meta %>'.split(',').filter(function(item){
    return GUEST_INFO.indexOf(item) > -1
  });
  var REQUIRED_FIELDS = ['nick','mail','link'];
  var requiredFields = '<%= theme.comments.valine.requiredFields %>'.split(',').filter(function(item){
    return REQUIRED_FIELDS.indexOf(item) > -1
  });
  var valine = new Valine();
  function emoji(path, idx, ext) {
      return path + "/" + path + "-" + idx + "." + ext;
  }
  var emojiMaps = {};
  for (var i = 1; i <= 54; i++) {
    emojiMaps['tieba-' + i] = emoji('tieba', i, 'png');
  }
  for (var i = 1; i <= 101; i++) {
    emojiMaps['qq-' + i] = emoji('qq', i, 'gif');
  }
  for (var i = 1; i <= 116; i++) {
    emojiMaps['aru-' + i] = emoji('aru', i, 'gif');
  }
  for (var i = 1; i <= 125; i++) {
    emojiMaps['twemoji-' + i] = emoji('twemoji', i, 'png');
  }
  for (var i = 1; i <= 4; i++) {
    emojiMaps['weibo-' + i] = emoji('weibo', i, 'png');
  }
  valine.init({
    el: '#valine_container',
    meta: meta,
    <% if (page.valine && page.valine.path) { %>
      path: "<%= page.valine.path %>",
    <% } else if (theme.comments.valine.path) { %>
      path: "<%= theme.comments.valine.path %>",
    <% } %>
    appId: "<%= theme.comments.valine.appId %>",
    appKey: "<%= theme.comments.valine.appKey %>",
    placeholder: "<%= (page.valine && page.valine.placeholder) ? page.valine.placeholder : theme.comments.valine.placeholder %>",
    pageSize:'<%= theme.comments.valine.pageSize %>',
    avatar:'<%= theme.comments.valine.avatar %>',
    lang:'<%= theme.comments.valine.lang %>',
//  visitor: '<%= theme.comments.valine.visitor %>',
    highlight: '<%= theme.comments.valine.highlight %>',
    mathJax: '<%= theme.comments.valine.mathJax %>',
    enableQQ: '<%= theme.comments.valine.enableQQ %>',
    requiredFields: requiredFields,
    emojiCDN: 'https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/emoji/valine/',
    emojiMaps: emojiMaps,
    metaPlaceholder: { "nick": "昵称 / QQ 号", "mail": "邮箱(必填)" },
    meta: ["nick", "mail", "link"],
    tagMeta: ["管理员", "小伙伴", "访客"],
    master: ["b5bd5d836c7a0091aa8473e79ed4c25e"],
    friends: ["adb7d1cd192658a55c0ad22a3309cecf", "e011329178b200bcb5d94f0d0ff7544a", "de8a7aa53d07e6b6bceb45c64027763d", "dc99f0dbf8bf2e93a9774befccdbd112", "3ce1e6c77b4910f1871106cb30dc62b0", "f2989ab3c92b4e89ed1777a3c8fe69a8", "715bb78d6b2a07e137f3879fe99b45d4", "f04c1216d2195585d2ad214854044e37", "cfce8dc43725cc14ffcd9fb4892d5bfc", "e4eb5f8ca02662b14012cf4361902013", "83d86348dcf8816937ff926140adfc4d", "48c8f1e79dd340e4b247820fee013082", "6ae08e7adef0f1deac117254634c321a", "8087a7f23b435c1eaff1f31103bc60bc", "ace17cd3a53d0e8567d389fc7004ed9d", "0ba7b878d4a392fb04f8f4090fcc2248"]
  })
  </script>
<% } %>

<% if (config.use_cdn && theme.info && theme.info.cdn && theme.info.cdn.js) { %>
  <%- js(theme.info.cdn.js) %>
<% } else { %>
  <%- js(['js/app.js']) %>
<% } %>
<% if (theme.search && theme.search.enable && theme.search.js) { %>
  <%- js(theme.search.js) %>
<% } %>
<% if (theme.plugins.comment_typing) { %>
  <%- js(theme.plugins.comment_typing) %>
<%}%>

<!-- 复制 -->
<% if (theme.plugins.clipboard && theme.style.body.highlight.copy_btn) { %>
  <%- partial('_third-party/clipboard') %>
<% } %>


<!-- fancybox -->
<% if (theme.plugins.fancybox) { %>
  <%- partial('_third-party/fancybox') %>
<% } %>


<% if (config.import && config.import.script){ %>
<% (config.import.script||[]).forEach(function(item){ %>
<%- item %><% }) %>
<% } %>
